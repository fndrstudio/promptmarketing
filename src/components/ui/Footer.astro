---
/*
  Footer
  -------------
  Expects FooterData:
  - logo?: { src, alt? }
  - footerAbout: { aboutText }
  - footerColumns: [{ title, links: [{ label, href }] }]
  - copyright: { text, legal: [{ label, href }] }
*/

// Components
// - UI
import Row from './Row.astro'
import Col from './Col.astro'
import DecorationBorder from './DecorationBorder.astro'
import SectionSpacer from './SectionSpacer.astro'
import Button from './Button.astro'

// Content
// - Data
import { getFooterNavigationData } from '../../config/footerNavigation'
const { logo, footerAbout, footerColumns, copyright } = await getFooterNavigationData()
---

<footer class="footer">
	<div class="container">
		<!-- Main footer -->
		<Row classes="gap-y-0!">
			<!-- Logo -->
			<Col span="4" classes="flex justify-center items-center ">
				<div class="footer__logo">
					{
						logo?.src && (
							<a href={`/`}>
								<img
									src={logo.src}
									alt={logo.alt}
									width="360"
									height="360"
									class="block dark:hidden"
								/>
								<img
									src={logo.srcDark}
									alt={logo.alt}
									width="360"
									height="360"
									class="hidden dark:block"
								/>
							</a>
						)
					}
				</div>
			</Col>
			<!-- Content -->
			<Col span="8">
				<div class="footer__content">
					<div>
						{
							footerAbout?.aboutText && (
								<h2 class="footer__about h5">{footerAbout.aboutText}</h2>
							)
						}
					</div>
					<div class="footer__navigation">
						<!-- Navigation Columns -->
						{
							footerColumns?.map((column, index) => (
								<div class="footer__col">
									{column.title && (
										<h3 class="footer__col-title h4">{column.title}</h3>
									)}
									<ul class="footer__links">
										{column.links?.map((link) => (
											<li>
												<a href={link.href}>{link.label}</a>
											</li>
										))}
									</ul>
									<DecorationBorder
										type="left"
										style="dashed"
										extraClasses={`hidden lg:block ${index === 0 ? 'lg:hidden' : ''}`}
									/>
								</div>
							))
						}

						<!-- Newsletter Column -->
						<div class="footer__col">
							<h3 class="footer__col-title h4">Newsletter</h3>
							<p>Get AI search insights delivered to your inbox</p>
							<form id="newsletter-form" class="mt-4">
								<input type="hidden" name="access_key" value="40c969ec-7a42-4a10-b33a-04b57824250e" />
								<input type="hidden" name="subject" value="New Newsletter Subscription" />
								<input type="hidden" name="from_name" value="Prompt Marketing Newsletter" />
								<input
									type="email"
									name="email"
									placeholder="Enter your email"
									aria-label="Email address for newsletter"
									required
									class="focus:border-primary-500 mb-2 w-full rounded-full border border-neutral-200 px-4 py-2 text-sm focus:outline-none dark:border-neutral-700 dark:bg-neutral-900"
								/>
								<Button type="submit" size="sm" classes="w-full">
									Subscribe
								</Button>
								<p id="newsletter-result" class="mt-2 text-sm hidden"></p>
							</form>
							<DecorationBorder
								type="left"
								style="dashed"
								extraClasses="hidden lg:block"
							/>
						</div>

						<DecorationBorder type="top bottom" style="dashed" />
					</div>

					<div class="footer__copy">
						<p class="footer__copyright h5">{copyright?.text}</p>
						<p class="footer__address h5">Jacob Bontiusplaats 9, 1018LL Amsterdam</p>
						<div class="footer__legal">
							{
								copyright?.legal?.length && (
									<ul class="footer__legal-links">
										{copyright.legal.map((l) => (
											<li>
												<a class="footer__legal-link h5" href={l.href}>
													{l.label}
												</a>
											</li>
										))}
									</ul>
								)
							}
						</div>
					</div>
				</div>
			</Col>
		</Row>
	</div>
	<DecorationBorder type="top bottom" style="dashed" />
</footer>
<SectionSpacer style="primary" />
<style>
	@reference '../../styles/global.css';
	.footer {
		@apply relative [&_li]:m-0 [&_li]:list-none [&_li]:pl-0;
	}

	.footer__logo {
		@apply flex h-full w-full items-center justify-center border-b border-neutral-200 bg-white lg:border-r dark:border-neutral-700 dark:bg-neutral-950 [&_img]:max-w-72 lg:[&_img]:max-w-96;
	}
	.footer__content {
		@apply flex flex-col bg-white bg-[url('/bgs/dot-gray-light.svg')] bg-size-[18px] lg:border-l lg:border-neutral-200 dark:bg-neutral-950 dark:bg-[url('/bgs/dot-teal-dark.svg')] lg:dark:border-neutral-700;
	}
	.footer__navigation {
		@apply relative flex w-full flex-row flex-wrap bg-white dark:bg-neutral-950;
	}
	.footer__about {
		@apply p-8 text-center lg:text-left;
	}
	.footer__copy {
		@apply flex flex-col items-center p-8 lg:flex-row lg:justify-between lg:gap-8;
	}
	.footer__col {
		@apply relative flex-1/2 px-8 pt-8 lg:flex-1 lg:py-8;
	}
	.footer__links {
		@apply [&_li]:mb-4 [&_li]:leading-6;
	}
	.footer__legal-links {
		@apply flex flex-row gap-4 lg:gap-8;
	}
	.footer__legal-link {
		@apply text-neutral-500 hover:text-neutral-700 dark:text-neutral-400 dark:hover:text-neutral-200 mb-0;
	}
	.footer__copyright {
		@apply mb-0;
	}
	.footer__address {
		@apply mb-0 text-neutral-500;
	}
</style>

<script>
	const form = document.getElementById('newsletter-form') as HTMLFormElement;
	const result = document.getElementById('newsletter-result') as HTMLElement;
	const button = form?.querySelector('button[type="submit"]') as HTMLButtonElement;

	form?.addEventListener('submit', async (e) => {
		e.preventDefault();

		// Show validation styles
		form.classList.add('show-validation');

		// Check if form is valid
		if (!form.checkValidity()) {
			return;
		}

		const originalText = button.textContent;
		button.textContent = 'Sending...';
		button.disabled = true;
		result.classList.add('hidden');

		const formData = new FormData(form);

		try {
			const response = await fetch('https://api.web3forms.com/submit', {
				method: 'POST',
				body: formData
			});

			const data = await response.json();

			result.classList.remove('hidden');
			if (data.success) {
				result.textContent = 'Thanks for subscribing!';
				result.classList.remove('text-red-500');
				result.classList.add('text-green-600', 'dark:text-green-400');
				form.reset();
				form.classList.remove('show-validation');
			} else {
				result.textContent = 'Something went wrong. Please try again.';
				result.classList.remove('text-green-600', 'dark:text-green-400');
				result.classList.add('text-red-500');
			}
		} catch (error) {
			result.classList.remove('hidden');
			result.textContent = 'Something went wrong. Please try again.';
			result.classList.add('text-red-500');
		} finally {
			button.textContent = originalText;
			button.disabled = false;
		}
	});
</script>

---
//
// Notification Toast Component
// Displays a dismissible notification banner with upgrade call-to-action

// Components
// - UI
import { Icon } from 'astro-icon/components'

// Content
// - Props
type Props = {
	title?: string
	message?: string
}

const {
	title = 'Ready to become machine-readable?',
	message = `<a href="/contact">Contact us</a> to learn how Relevance Engineering can help your brand become AI-ready.`
} = Astro.props
---

<div class="toast-wrapper">
	<div class="toast" data-toast>
		<div class="toast__bg-color"></div>
		<div class="toast__bg-image"></div>
		<div class="toast__content">
			<h4 class="toast__title">{title}</h4>
			<p class="toast__text" set:html={message} />
		</div>
		<button
			type="button"
			class="toast__close"
			aria-label="Dismiss notification"
			data-toast-close
		>
			<Icon name="x-mark" class="size-5" />
		</button>
	</div>
</div>

<script is:inline>
	;(() => {
		const state = (window.__pmToastState = window.__pmToastState || {
			shown: false,
			dismissed: false
		})

		const setupToast = () => {
			const toast = document.querySelector('[data-toast]')
			if (!toast) return

			// If user already dismissed, remove immediately and bail.
			if (state.dismissed) {
				toast.remove()
				return
			}

			const closeButton = toast.querySelector('[data-toast-close]')
			const show = (instant = false) => {
				if (instant) {
					toast.classList.add('is-visible')
					return
				}
				toast.classList.add('is-visible')
			}
			const hide = () => {
				state.dismissed = true
				toast.classList.add('is-hiding')
				toast.addEventListener('transitionend', () => toast.remove(), { once: true })
			}

			if (state.shown) {
				show(true)
			} else {
				setTimeout(() => {
					show()
					state.shown = true
				}, 3000)
			}

			closeButton?.addEventListener('click', (event) => {
				event.preventDefault()
				hide()
			})
		}

		setupToast()
		document.addEventListener('astro:after-swap', setupToast)
	})()
</script>

<style>
	@reference '../../styles/global.css';
	.toast-wrapper {
		@apply relative;
	}
	.toast {
		@apply shadow-primary-700/10 pointer-events-none fixed right-6 bottom-6 z-50 flex max-w-sm translate-y-6 items-start gap-4 overflow-hidden px-5 py-4 text-white opacity-0 shadow-xl backdrop-blur-sm transition-all duration-500 ease-out;
	}
	.toast.is-visible {
		@apply pointer-events-auto translate-y-0 opacity-100;
	}
	.toast.is-hiding {
		@apply pointer-events-none translate-y-6 opacity-0;
	}
	.toast__content {
		@apply relative z-10 flex flex-col gap-1;
	}
	.toast__bg-color {
		@apply absolute inset-0 z-0 bg-linear-[135deg,#036565_0%,#012d2d_35%,#036565_70%,#024d4d_100%] opacity-90;
	}
	.toast__bg-image {
		@apply absolute inset-0 z-0 bg-[url('/bgs/dot-gray-light.svg')] bg-size-[18px] bg-fixed opacity-30;
	}
	.toast__title {
		@apply mb-0 text-base text-white;
	}
	.toast__text {
		@apply relative z-10 text-sm text-white decoration-dotted [&>a]:font-medium! [&>a]:text-white [&>a]:underline;
	}
	.toast__text a {
		@apply underline decoration-white/60 underline-offset-4 transition hover:decoration-white;
	}
	.toast__close {
		@apply relative z-10 ml-auto inline-flex h-8 w-8 shrink-0 cursor-pointer items-center justify-center text-white transition hover:bg-white/20 hover:text-white focus-visible:outline-offset-2 focus-visible:outline-white/60;
	}
</style>

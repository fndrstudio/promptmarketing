---
// Header
// ------------
// Description: The HTML document head with SEO and analytics.
// Properties:
// - Title: the page title
// - Description: the page description
// - OgImage: the Open Graph image URL
// - Canonical: whether to include canonical URLs
// - Noindex: whether to add noindex and nofollow meta tags

// Imports
import { ClientRouter } from 'astro:transitions'
import GoogleAnalytics from '../../scripts/googleAnalytics.astro'
import GoogleTagManagerHead from '../../scripts/googleTagManagerHead.astro'
import GoogleSearchConsole from '../../scripts/googleSearchConsole.astro'
import LinkedInInsightTag from '../../scripts/linkedInInsightTag.astro'
// Partials
import Seo from './partials/Seo.astro'

// Content
// - Data
import { configData } from '../../../config/config'
import { googleAnalyticsMeasurementID } from '../../../config/analytics'
import { googleTagManagerID } from '../../../config/analytics'

// - Props
type Props = {
	title?: string
	description?: string
	ogImage?: string
	canonical?: boolean
	noindex?: boolean
}
const {
	title = configData.siteTitle,
	description = configData.siteDescription,
	ogImage = configData.ogImage,
	canonical = configData.canonical,
	noindex = configData.noindex
} = Astro.props
---

<head>
	<!-- Apply theme immediately before paint to prevent flash -->
	<script is:inline>
		(function() {
			function applyTheme(doc) {
				var saved = localStorage.getItem('theme');
				var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
				if (saved === 'dark' || (!saved && prefersDark)) {
					doc.documentElement.classList.add('dark');
				} else {
					doc.documentElement.classList.remove('dark');
				}
			}

			// Apply immediately on initial load
			applyTheme(document);

			// Apply before swap to prevent flash on navigation
			document.addEventListener('astro:before-swap', function(e) {
				applyTheme(e.newDocument);
			});
		})();
	</script>
	{googleAnalyticsMeasurementID && <GoogleAnalytics />}
	{googleTagManagerID && <GoogleTagManagerHead />}
	<GoogleSearchConsole />
	<LinkedInInsightTag />
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<Seo
		title={title}
		description={description}
		ogImage={ogImage}
		canonical={canonical}
		noindex={noindex}
	/>
	<link rel="icon" href="/favicon.png" type="image/png" />
	<link rel="sitemap" href="/sitemap-index.xml" />
	<meta name="generator" content={Astro.generator} />
	<meta name="theme-color" content="#134e4a" />
	<ClientRouter fallback="swap" />
</head>

---
phase: 05-sanity-cms-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - sanity.config.ts
  - sanity.cli.ts
  - schemas/index.ts
  - schemas/post.ts
  - src/env.d.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Sanity packages are installed and importable"
    - "Blog post schema defines all required fields"
    - "Studio configuration references existing Sanity project"
  artifacts:
    - path: "sanity.config.ts"
      provides: "Studio configuration"
      contains: "projectId: 'pbui2f8s'"
    - path: "schemas/post.ts"
      provides: "Blog post schema definition"
      exports: ["default"]
    - path: "sanity.cli.ts"
      provides: "CLI configuration for deployment"
      contains: "projectId"
  key_links:
    - from: "sanity.config.ts"
      to: "schemas/index.ts"
      via: "schema.types import"
      pattern: "types:\\s*schemas"
---

<objective>
Install Sanity packages and create blog post schema for CMS-powered blog content.

Purpose: Establish Sanity foundation with schema that matches existing blog frontmatter structure while adding category field for SEO.

Output:
- Sanity packages installed (`@sanity/astro`, `@sanity/client`, `sanity`, `astro-portabletext`, `@sanity/image-url`, `@sanity/scheduled-publishing`)
- `sanity.config.ts` with project configuration
- `sanity.cli.ts` for deployment commands
- Blog post schema with minimal fields per user decision
</objective>

<execution_context>
@/Users/thuijsmans/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thuijsmans/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-sanity-cms-integration/05-RESEARCH.md
@.planning/phases/05-sanity-cms-integration/05-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Sanity packages</name>
  <files>package.json</files>
  <action>
Install Sanity packages for Astro integration:

```bash
npm install @sanity/astro @sanity/client sanity astro-portabletext @sanity/image-url @sanity/scheduled-publishing
```

This adds:
- `@sanity/astro` - Official Astro integration (provides `sanity:client` module)
- `@sanity/client` - GROQ query execution
- `sanity` - Studio and CLI
- `astro-portabletext` - Portable Text rendering (Astro-native, not React)
- `@sanity/image-url` - Image CDN URL builder
- `@sanity/scheduled-publishing` - Scheduled publishing plugin

Do NOT install `@portabletext/react` - use `astro-portabletext` instead per research recommendations.
  </action>
  <verify>`npm list @sanity/astro @sanity/client sanity astro-portabletext @sanity/image-url @sanity/scheduled-publishing` shows all packages installed</verify>
  <done>All 6 Sanity packages appear in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create Sanity configuration files</name>
  <files>sanity.config.ts, sanity.cli.ts, schemas/index.ts, schemas/post.ts, src/env.d.ts</files>
  <action>
Create Sanity configuration in project root (NOT src/):

**sanity.config.ts:**
```typescript
import { defineConfig } from 'sanity'
import { structureTool } from 'sanity/structure'
import { visionTool } from '@sanity/vision'
import { scheduledPublishing } from '@sanity/scheduled-publishing'
import { schemas } from './schemas'

export default defineConfig({
  name: 'default',
  title: 'Prompt Marketing Blog',
  projectId: 'pbui2f8s',
  dataset: 'production',

  plugins: [
    structureTool(),
    visionTool(),
    scheduledPublishing(),
  ],

  schema: {
    types: schemas,
  },
})
```

**sanity.cli.ts:**
```typescript
import { defineCliConfig } from 'sanity/cli'

export default defineCliConfig({
  api: {
    projectId: 'pbui2f8s',
    dataset: 'production',
  },
  studioHost: 'promptmarketing',
})
```

**schemas/index.ts:**
```typescript
import post from './post'

export const schemas = [post]
```

**schemas/post.ts:**
Create blog post schema with MINIMAL fields per user decision:
- title (string, required, max 100 chars)
- slug (slug, required, source: title)
- publishedAt (datetime, required, default: now)
- author (string, required) - Simple text field, NOT separate document
- category (string, required) - Predefined list for SEO:
  - AI Strategy (`ai-strategy`)
  - Prompt Engineering (`prompt-engineering`)
  - Agentic Commerce (`agentic-commerce`)
  - Relevance Engineering (`relevance-engineering`)
  - Machine Readability (`machine-readability`)
- featuredImage (image, optional, with hotspot enabled)
- body (array of blocks) - Portable Text with:
  - Styles: normal, h2, h3, blockquote
  - Marks: strong, em, link
  - NO inline images per user decision

Categories chosen to match PromptMarketing's service pillars and thought leadership areas.

**src/env.d.ts:**
Add Sanity module reference after existing Astro reference:
```typescript
/// <reference types="@sanity/astro/module" />
```
  </action>
  <verify>
- `cat sanity.config.ts` shows projectId 'pbui2f8s'
- `cat schemas/post.ts` shows defineType with all 6 fields
- `cat src/env.d.ts` includes Sanity module reference
- `npx sanity schema extract` runs without errors (validates schema)
  </verify>
  <done>Sanity config files exist with correct project ID and blog post schema defines title, slug, publishedAt, author, category, featuredImage, body fields</done>
</task>

</tasks>

<verification>
- [ ] `npm list` shows all 6 Sanity packages
- [ ] `sanity.config.ts` exists in project root with projectId 'pbui2f8s'
- [ ] `schemas/post.ts` defines blog post with 7 fields (title, slug, publishedAt, author, category, featuredImage, body)
- [ ] Schema uses simple author string (not document reference)
- [ ] Category field has 5 predefined options
- [ ] Body field is Portable Text with no inline image types
</verification>

<success_criteria>
Sanity foundation complete: packages installed, config created, blog post schema defined with minimal fields matching user decisions. Ready for Astro integration in Plan 02.
</success_criteria>

<output>
After completion, create `.planning/phases/05-sanity-cms-integration/05-01-SUMMARY.md`
</output>
